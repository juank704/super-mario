!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=21)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var r=n(15);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}},function(t,e,n){var r=n(16),i=n(17);t.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e}},function(t,e,n){t.exports=n(11)},function(t,e,n){var r=n(12),i=n(13),o=n(9),a=n(14);t.exports=function(t,e){return r(t)||i(t,e)||o(t,e)||a()}},function(t,e,n){var r=n(18),i=n(19),o=n(9),a=n(20);t.exports=function(t){return r(t)||i(t)||o(t)||a()}},function(t,e){function n(t,e,n,r,i,o,a){try{var u=t[o](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,i)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(i,o){var a=t.apply(e,r);function u(t){n(a,i,o,u,c,"next",t)}function c(t){n(a,i,o,u,c,"throw",t)}u(void 0)}))}}},function(t,e,n){var r=n(10);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n,r){var i=e&&e.prototype instanceof f?e:f,o=Object.create(i.prototype),a=new k(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return T()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var u=b(a,n);if(u){if(u===s)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var f=c(t,e,n);if("normal"===f.type){if(r=n.done?"completed":"suspendedYield",f.arg===s)continue;return{value:f.arg,done:n.done}}"throw"===f.type&&(r="completed",n.method="throw",n.arg=f.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var s={};function f(){}function l(){}function h(){}var y={};y[i]=function(){return this};var d=Object.getPrototypeOf,v=d&&d(d(S([])));v&&v!==e&&n.call(v,i)&&(y=v);var p=h.prototype=f.prototype=Object.create(y);function m(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function g(t,e){var r;this._invoke=function(i,o){function a(){return new e((function(r,a){!function r(i,o,a,u){var s=c(t[i],t,o);if("throw"!==s.type){var f=s.arg,l=f.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return s;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,s;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return l.prototype=p.constructor=h,h.constructor=l,h[a]=l.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(p),t},t.awrap=function(t){return{__await:t}},m(g.prototype),g.prototype[o]=function(){return this},t.AsyncIterator=g,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new g(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(p),p[a]="Generator",p[i]=function(){return this},p.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),s}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e){function n(e,r){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,r)}t.exports=n},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,n){var r=n(10);t.exports=function(t){if(Array.isArray(t))return r(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){"use strict";n.r(e);var r=n(5),i=n.n(r),o=n(6),a=n.n(o),u=n(8),c=n.n(u),s=n(0),f=n.n(s),l=n(1),h=n.n(l),y=n(3),d=n.n(y),v=n(4),p=n.n(v),m=n(2),g=n.n(m),b=function(){function t(){f()(this,t),this.grid=[]}return h()(t,[{key:"forEach",value:function(t){this.grid.forEach((function(e,n){e.forEach((function(e,r){t(e,n,r)}))}))}},{key:"delete",value:function(t,e){var n=this.grid[t];n&&delete n[e]}},{key:"get",value:function(t,e){var n=this.grid[t];if(n)return n[e]}},{key:"set",value:function(t,e,n){this.grid[t]||(this.grid[t]=[]),this.grid[t][e]=n}}]),t}(),w=function(){function t(e,n){f()(this,t),this.set(e,n)}return h()(t,[{key:"copy",value:function(t){this.x=t.x,this.y=t.y}},{key:"set",value:function(t,e){this.x=t,this.y=e}}]),t}(),x=function t(){f()(this,t),this.pos=new w(0,0),this.size=new w(256,224)},k=function(){function t(){f()(this,t),this.layers=[]}return h()(t,[{key:"draw",value:function(t,e){this.layers.forEach((function(n){n(t,e)}))}}]),t}(),S=function(){function t(){f()(this,t),this.listeners=[]}return h()(t,[{key:"listen",value:function(t,e){var n={name:t,callback:e};this.listeners.push(n)}},{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.listeners.forEach((function(e){e.name===t&&e.callback.apply(e,n)}))}}]),t}(),T=function(){function t(){f()(this,t),this.player=null}return h()(t,[{key:"setPlayer",value:function(t){this.player=t}},{key:"playTheme",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.player.playTrack("main");e.playbackRate=t}},{key:"playHurryTheme",value:function(){var t=this,e=this.player.playTrack("hurry");e.loop=!1,e.addEventListener("ended",(function(){t.playTheme(1.3)}),{once:!0})}},{key:"pause",value:function(){this.player.pauseAll()}}]),t}(),E=function(){function t(e){f()(this,t),this.entities=e}return h()(t,[{key:"check",value:function(t){this.entities.forEach((function(e){t!==e&&t.bounds.overlaps(e.bounds)&&t.collides(e)}))}}]),t}(),R=function(){function t(){f()(this,t),this.events=new S,this.comp=new k}return h()(t,[{key:"draw",value:function(t){this.comp.draw(t.videoContext)}},{key:"update",value:function(t){}},{key:"pause",value:function(){console.log("Pause",this)}}]),t}();R.EVENT_COMPLETE=Symbol("scene complete");var A=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;f()(this,t),this.matrix=e,this.tileSize=n}return h()(t,[{key:"toIndex",value:function(t){return Math.floor(t/this.tileSize)}},{key:"toIndexRange",value:function(t,e){var n=Math.ceil(e/this.tileSize)*this.tileSize,r=[],i=t;do{r.push(this.toIndex(i)),i+=this.tileSize}while(i<n);return r}},{key:"getByIndex",value:function(t,e){var n=this.matrix.get(t,e);if(n){var r=t*this.tileSize,i=r+this.tileSize,o=e*this.tileSize;return{tile:n,indexX:t,indexY:e,x1:r,x2:i,y1:o,y2:o+this.tileSize}}}},{key:"searchByPosition",value:function(t,e){return this.getByIndex(this.toIndex(t),this.toIndex(e))}},{key:"searchByRange",value:function(t,e,n,r){var i=this,o=[];return this.toIndexRange(t,e).forEach((function(t){i.toIndexRange(n,r).forEach((function(e){var n=i.getByIndex(t,e);n&&o.push(n)}))})),o}}]),t}(),I=function(){function t(){f()(this,t),this.buffers=new Map}return h()(t,[{key:"addAudio",value:function(t,e){this.buffers.set(t,e)}},{key:"playAudio",value:function(t,e){var n=e.createBufferSource();n.connect(e.destination),n.buffer=this.buffers.get(t),n.start(0)}}]),t}(),O=function(){function t(e,n,r){f()(this,t),this.pos=e,this.size=n,this.offset=r}return h()(t,[{key:"overlaps",value:function(t){return this.bottom>t.top&&this.top<t.bottom&&this.left<t.right&&this.right>t.left}},{key:"bottom",get:function(){return this.pos.y+this.size.y+this.offset.y},set:function(t){this.pos.y=t-(this.size.y+this.offset.y)}},{key:"top",get:function(){return this.pos.y+this.offset.y},set:function(t){this.pos.y=t-this.offset.y}},{key:"left",get:function(){return this.pos.x+this.offset.x},set:function(t){this.pos.x=t-this.offset.x}},{key:"right",get:function(){return this.pos.x+this.size.x+this.offset.x},set:function(t){this.pos.x=t-(this.size.x+this.offset.x)}}]),t}(),j=n(7),M=n.n(j),P=function(){function t(){f()(this,t),this.events=[]}return h()(t,[{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i={name:t,args:n};this.events.push(i)}},{key:"process",value:function(t,e){this.events.forEach((function(n){n.name===t&&e.apply(void 0,M()(n.args))}))}},{key:"clear",value:function(){this.events.length=0}}]),t}(),D=function(){function t(){f()(this,t),this.listeners=[]}return h()(t,[{key:"listen",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,r={name:t,callback:e,count:n};this.listeners.push(r)}},{key:"finalize",value:function(t){this.listeners=this.listeners.filter((function(e){return t.events.process(e.name,e.callback),--e.count}))}},{key:"queue",value:function(e){this.listen(t.EVENT_TASK,e,1)}},{key:"collides",value:function(t,e){}},{key:"obstruct",value:function(){}},{key:"update",value:function(){}}]),t}();D.EVENT_TASK=Symbol("task");var _={TOP:Symbol("top"),BOTTOM:Symbol("bottom"),LEFT:Symbol("left"),RIGHT:Symbol("right")},L=function(){function t(){f()(this,t),this.audio=new I,this.events=new P,this.sounds=new Set,this.events=new P,this.pos=new w(0,0),this.vel=new w(0,0),this.size=new w(0,0),this.offset=new w(0,0),this.bounds=new O(this.pos,this.size,this.offset),this.lifetime=0,this.traits=new Map}return h()(t,[{key:"addTrait",value:function(t){this.traits.set(t.constructor,t)}},{key:"collides",value:function(t){var e=this;this.traits.forEach((function(n){n.collides(e,t)}))}},{key:"obstruct",value:function(t,e){var n=this;this.traits.forEach((function(r){r.obstruct(n,t,e)}))}},{key:"draw",value:function(){}},{key:"finalize",value:function(){var t=this;this.events.emit(D.EVENT_TASK,this),this.traits.forEach((function(e){e.finalize(t)})),this.events.clear()}},{key:"playSounds",value:function(t,e){this.sounds.forEach((function(n){t.playAudio(n,e)})),this.sounds.clear()}},{key:"update",value:function(t,e){var n=this;this.traits.forEach((function(r){r.update(n,t,e)})),this.playSounds(this.audio,t.audioContext),this.lifetime+=t.deltaTime}}]),t}();function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var z=function(t){d()(n,t);var e=C(n);function n(){var t;return f()(this,n),(t=e.call(this)).dead=!1,t.deadTime=0,t.removeAfter=2,t}return h()(n,[{key:"kill",value:function(){var t=this;this.queue((function(){return t.dead=!0}))}},{key:"revive",value:function(){this.dead=!1,this.deadTime=0}},{key:"update",value:function(t,e,n){var r=e.deltaTime;this.dead&&(this.deadTime+=r,this.deadTime>this.removeAfter&&this.queue((function(){n.entities.delete(t)})))}}]),n}(D);function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var G=function(t){d()(n,t);var e=N(n);function n(){var t;return f()(this,n),(t=e.call(this)).bounceSpeed=400,t}return h()(n,[{key:"bounce",value:function(t,e){t.bounds.bottom=e.bounds.top,t.vel.y=-this.bounceSpeed}},{key:"collides",value:function(t,e){var r=this;e.traits.has(z)&&!e.traits.get(z).dead&&t.vel.y>e.vel.y&&(this.queue((function(){return r.bounce(t,e)})),t.sounds.add("stomp"),t.events.emit(n.EVENT_STOMP,t,e))}}]),n}(D);function B(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}G.EVENT_STOMP=Symbol("stomp");var F=function(t){d()(n,t);var e=B(n);function n(){var t;return f()(this,n),(t=e.call(this)).name="UNNAMED",t.coins=0,t.lives=3,t.score=0,t.listen(G.EVENT_STOMP,(function(){t.score+=100,console.log("Score",t.score)})),t}return h()(n,[{key:"addCoins",value:function(t){for(this.coins+=t,this.queue((function(t){return t.sounds.add("coin")}));this.coins>=100;)this.addLives(1),this.coins-=100}},{key:"addLives",value:function(t){this.lives+=t}}]),n}(D);function U(t){var e=t.entity,n=t.match,r=t.resolver;e.player&&(e.player.addCoins(1),r.matrix.delete(n.indexX,n.indexY))}function V(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $={brick:[function(t){var e=t.entity,n=t.match;e.vel.x>0?e.bounds.right>n.x1&&e.obstruct(_.RIGHT,n):e.vel.x<0&&e.bounds.left<n.x2&&e.obstruct(_.LEFT,n)},function(t){var e=t.entity,n=t.match,r=t.resolver,i=t.gameContext,o=t.level;if(e.vel.y>0)e.bounds.bottom>n.y1&&e.obstruct(_.BOTTOM,n);else if(e.vel.y<0){if(e.traits.has(F)){r.matrix.delete(n.indexX,n.indexY);var a=i.entityFactory.goomba();a.vel.set(50,-400),a.pos.set(e.pos.x,n.y1),o.entities.add(a)}e.bounds.top<n.y2&&e.obstruct(_.TOP,n)}}],coin:[U,U],ground:[function(t){var e=t.entity,n=t.match;e.vel.x>0?e.bounds.right>n.x1&&e.obstruct(_.RIGHT,n):e.vel.x<0&&e.bounds.left<n.x2&&e.obstruct(_.LEFT,n)},function(t){var e=t.entity,n=t.match;e.vel.y>0?e.bounds.bottom>n.y1&&e.obstruct(_.BOTTOM,n):e.vel.y<0&&e.bounds.top<n.y2&&e.obstruct(_.TOP,n)}]},Y=function(){function t(){f()(this,t),this.resolvers=[]}return h()(t,[{key:"addGrid",value:function(t){this.resolvers.push(new A(t))}},{key:"checkX",value:function(t,e,n){var r,i=this;if(t.vel.x>0)r=t.bounds.right;else{if(!(t.vel.x<0))return;r=t.bounds.left}var o,a=V(this.resolvers);try{var u=function(){var a=o.value;a.searchByRange(r,r,t.bounds.top,t.bounds.bottom).forEach((function(r){i.handle(0,t,r,a,e,n)}))};for(a.s();!(o=a.n()).done;)u()}catch(t){a.e(t)}finally{a.f()}}},{key:"checkY",value:function(t,e,n){var r,i=this;if(t.vel.y>0)r=t.bounds.bottom;else{if(!(t.vel.y<0))return;r=t.bounds.top}var o,a=V(this.resolvers);try{var u=function(){var a=o.value;a.searchByRange(t.bounds.left,t.bounds.right,r,r).forEach((function(r){i.handle(1,t,r,a,e,n)}))};for(a.s();!(o=a.n()).done;)u()}catch(t){a.e(t)}finally{a.f()}}},{key:"handle",value:function(t,e,n,r,i,o){var a={entity:e,match:n,resolver:r,gameContext:i,level:o},u=$[n.tile.type];u&&u[t](a)}}]),t}();function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var H=function(t){d()(n,t);var e=K(n);function n(){var t;return f()(this,n),(t=e.call(this)).checkpoint=new w(0,0),t.player=null,t}return h()(n,[{key:"setPlayer",value:function(t){this.player=t}},{key:"update",value:function(t,e,n){e.deltaTime;n.entities.has(this.player)||(this.player.killable.revive(),this.player.pos.set(this.checkpoint.x,this.checkpoint.y),n.entities.add(this.player))}}]),n}(D),X=i.a.mark(tt);function W(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return J(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return J(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Q(t){var e=new L,n=new H;return n.checkpoint.set(64,64),n.setPlayer(t),e.addTrait(n),e}function Z(t,e){var n=new F;n.name="MARIO",t.addTrait(n)}function tt(t){var e,n,r;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:e=W(t),i.prev=1,e.s();case 3:if((n=e.n()).done){i.next=10;break}if(!(r=n.value).traits.has(F)){i.next=8;break}return i.next=8,r;case 8:i.next=3;break;case 10:i.next=15;break;case 12:i.prev=12,i.t0=i.catch(1),e.e(i.t0);case 15:return i.prev=15,e.f(),i.finish(15);case 18:case"end":return i.stop()}}),X,null,[[1,12,15,18]])}function et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}function nt(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return rt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var it=function(t){d()(n,t);var e=et(n);function n(){var t;return f()(this,n),(t=e.call(this)).name="",t.gravity=1500,t.totalTime=0,t.camera=new x,t.music=new T,t.entities=new Set,t.entityCollider=new E(t.entities),t.tileCollider=new Y,t}return h()(n,[{key:"draw",value:function(t){this.comp.draw(t.videoContext,this.camera)}},{key:"update",value:function(t){var e=this;this.entities.forEach((function(n){n.update(t,e)})),this.entities.forEach((function(t){e.entityCollider.check(t)})),this.entities.forEach((function(t){t.finalize()})),function(t){var e,n=nt(tt(t.entities));try{for(n.s();!(e=n.n()).done;){var r=e.value;t.camera.pos.x=Math.max(0,r.pos.x-100)}}catch(t){n.e(t)}finally{n.f()}}(this),this.totalTime+=t.deltaTime}},{key:"pause",value:function(){this.music.pause()}}]),n}(R);it.EVENT_TRIGGER=Symbol("trigger");var ot=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/60;f()(this,t);var r=0,i=null;this.updateProxy=function(t){if(i)for((r+=(t-i)/1e3)>1&&(r=1);r>n;)e.update(n),r-=n;i=t,e.enqueue()}}return h()(t,[{key:"enqueue",value:function(){requestAnimationFrame(this.updateProxy)}},{key:"start",value:function(){this.enqueue()}}]),t}();function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ut=function(t){d()(n,t);var e=at(n);function n(){var t;return f()(this,n),(t=e.call(this)).totalTime=300,t.currentTime=t.totalTime,t.hurryTime=100,t.hurryEmitted=null,t}return h()(n,[{key:"update",value:function(t,e,r){var i=e.deltaTime;this.currentTime-=2*i,!0!==this.hurryEmitted&&this.currentTime<this.hurryTime&&(r.events.emit(n.EVENT_TIMER_HURRY),this.hurryEmitted=!0),!1!==this.hurryEmitted&&this.currentTime>this.hurryTime&&(r.events.emit(n.EVENT_TIMER_OK),this.hurryEmitted=!1)}}]),n}(D);function ct(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return st(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return st(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function st(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}ut.EVENT_TIMER_HURRY=Symbol("timer hurry"),ut.EVENT_TIMER_OK=Symbol("timer ok");var lt=function(t){d()(n,t);var e=ft(n);function n(){var t;return f()(this,n),(t=e.call(this)).touches=new Set,t.conditions=[],t}return h()(n,[{key:"collides",value:function(t,e){this.touches.add(e)}},{key:"update",value:function(t,e,n){if(this.touches.size>0){var r,i=ct(this.conditions);try{for(i.s();!(r=i.n()).done;){(0,r.value)(t,this.touches,e,n)}}catch(t){i.e(t)}finally{i.f()}this.touches.clear()}}}]),n}(D);function ht(t){return new Promise((function(e){var n=new Image;n.addEventListener("load",(function(){e(n)})),n.src=t}))}function yt(t){return fetch(t).then((function(t){return t.json()}))}function dt(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return vt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var pt=function(){function t(){f()(this,t),this.tracks=new Map}return h()(t,[{key:"addTrack",value:function(t,e){var n=new Audio;n.loop=!0,n.src=e,this.tracks.set(t,n)}},{key:"playTrack",value:function(t){return this.pauseAll(),this.tracks.get(t)}},{key:"pauseAll",value:function(){var t,e=dt(this.tracks.values());try{for(e.s();!(t=e.n()).done;){t.value.pause()}}catch(t){e.e(t)}finally{e.f()}}}]),t}();function mt(t){return yt("".concat("super-mario/public/","music/").concat(t,".json")).then((function(t){for(var e=new pt,n=0,r=Object.entries(t);n<r.length;n++){var i=a()(r[n],2),o=i[0],u=i[1];e.addTrack(o,u.url)}return e}))}var gt=function(){function t(e,n,r){f()(this,t),this.image=e,this.width=n,this.height=r,this.tiles=new Map,this.animations=new Map}return h()(t,[{key:"defineAnim",value:function(t,e){this.animations.set(t,e)}},{key:"define",value:function(t,e,n,r,i){var o=this,a=[!1,!0].map((function(t){var a=document.createElement("canvas");a.width=r,a.height=i;var u=a.getContext("2d");return t&&(u.scale(-1,1),u.translate(-r,0)),u.drawImage(o.image,e,n,r,i,0,0,r,i),a}));this.tiles.set(t,a)}},{key:"defineTile",value:function(t,e,n){this.define(t,e*this.width,n*this.height,this.width,this.height)}},{key:"draw",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.tiles.get(t)[i?1:0];e.drawImage(o,n,r)}},{key:"drawAnim",value:function(t,e,n,r,i){var o=this.animations.get(t);this.drawTile(o(i),e,n,r)}},{key:"drawTile",value:function(t,e,n,r){this.draw(t,e,n*this.width,r*this.height)}}]),t}();function bt(t){return yt("".concat("super-mario/public/","sprites/").concat(t,".json")).then((function(t){return Promise.all([t,ht("".concat("super-mario/public/"+t.imageURL))])})).then((function(t){var e=a()(t,2),n=e[0],r=e[1],i=new gt(r,n.tileW,n.tileH);return n.tiles&&n.tiles.forEach((function(t){i.defineTile(t.name,t.index[0],t.index[1])})),n.frames&&n.frames.forEach((function(t){i.define.apply(i,[t.name].concat(M()(t.rect)))})),n.animations&&n.animations.forEach((function(t){var e,n,r=(e=t.frames,n=t.frameLen,function(t){var r=Math.floor(t/n)%e.length;return e[r]});i.defineAnim(t.name,r)})),i}))}var wt=i.a.mark(jt),xt=i.a.mark(Pt),kt=i.a.mark(Dt);function St(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Tt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Et(t){return yt("".concat("super-mario/public/","sprites/patterns/").concat(t,".json"))}function Rt(t){var e=function(){var t=new L;return t.addTrait(new ut),t}();t.entities.add(e),t.events.listen(ut.EVENT_TIMER_OK,(function(){t.music.playTheme()})),t.events.listen(ut.EVENT_TIMER_HURRY,(function(){t.music.playHurryTheme()}))}function At(t,e,n,r){t.layers.forEach((function(t){var i=function(t,e){var n,r=new b,i=St(Dt(t,e));try{for(i.s();!(n=i.n()).done;){var o=n.value,a=o.tile,u=o.x,c=o.y;r.set(u,c,a)}}catch(t){i.e(t)}finally{i.f()}return r}(t.tiles,r),o=function(t,e,n){var r=new A(e),i=document.createElement("canvas");i.width=272,i.height=240;var o=i.getContext("2d");function a(r,a){o.clearRect(0,0,i.width,i.height);for(var u=function(i){var a=e.grid[i];a&&a.forEach((function(e,a){n.animations.has(e.name)?n.drawAnim(e.name,o,i-r,a,t.totalTime):n.drawTile(e.name,o,i-r,a)}))},c=r;c<=a;++c)u(c)}return function(t,e){var n=r.toIndex(e.size.x),o=r.toIndex(e.pos.x);a(o,o+n),t.drawImage(i,Math.floor(-e.pos.x%16),Math.floor(-e.pos.y))}}(e,i,n);e.comp.layers.push(o),e.tileCollider.addGrid(i)}))}function It(t,e,n){t.entities.forEach((function(t){var r=t.name,i=a()(t.pos,2),o=i[0],u=i[1],c=(0,n[r])();c.pos.set(o,u),e.entities.add(c)}));var r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,r=document.createElement("canvas");r.width=e,r.height=n;var i=r.getContext("2d");return function(o,a){t.forEach((function(t){i.clearRect(0,0,e,n),t.draw(i),o.drawImage(r,Math.floor(t.pos.x-a.pos.x),Math.floor(t.pos.y-a.pos.y))}))}}(e.entities);e.comp.layers.push(r)}function Ot(t){return function(e){return yt("".concat("super-mario/public/","levels/").concat(e,".json")).then((function(t){return Promise.all([t,bt(t.spriteSheet),mt(t.musicSheet),Et(t.patternSheet)])})).then((function(n){var r=a()(n,4),i=r[0],o=r[1],u=r[2],c=r[3],s=new it;return s.name=e,s.music.setPlayer(u),At(i,s,o,c),It(i,s,t),function(t,e){if(t.triggers){var n,r=St(t.triggers);try{var i=function(){var t=n.value,r=new lt;r.conditions.push((function(e,n,r,i){i.events.emit(it.EVENT_TRIGGER,t,e,n)}));var i=new L;i.addTrait(r),i.size.set(64,64),i.pos.set(t.pos[0],t.pos[1]),e.entities.add(i)};for(r.s();!(n=r.n()).done;)i()}catch(t){r.e(t)}finally{r.f()}}}(i,s),Rt(s),s}))}}function jt(t,e,n,r){var o,a,u,c;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:o=t+e,a=n+r,u=t;case 3:if(!(u<o)){i.next=14;break}c=n;case 5:if(!(c<a)){i.next=11;break}return i.next=8,{x:u,y:c};case 8:++c,i.next=5;break;case 11:++u,i.next=3;break;case 14:case"end":return i.stop()}}),wt)}function Mt(t){if(4===t.length){var e=a()(t,4);return jt(e[0],e[1],e[2],e[3])}if(3===t.length){var n=a()(t,3);return jt(n[0],n[1],n[2],1)}if(2===t.length){var r=a()(t,2);return jt(r[0],1,r[1],1)}}function Pt(t){var e,n,r;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:e=St(t),i.prev=1,e.s();case 3:if((n=e.n()).done){i.next=8;break}return r=n.value,i.delegateYield(Mt(r),"t0",6);case 6:i.next=3;break;case 8:i.next=13;break;case 10:i.prev=10,i.t1=i.catch(1),e.e(i.t1);case 13:return i.prev=13,e.f(),i.finish(13);case 16:case"end":return i.stop()}}),xt,null,[[1,10,13,16]])}function Dt(t,e){var n,r;return i.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r=function(t,o,a){var u,c,s,f,l,h,y,d,v,p,m;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:u=St(t),n.prev=1,u.s();case 3:if((c=u.n()).done){n.next=31;break}s=c.value,f=St(Pt(s.ranges)),n.prev=6,f.s();case 8:if((l=f.n()).done){n.next=21;break}if(h=l.value,y=h.x,d=h.y,v=y+o,p=d+a,!s.pattern){n.next=17;break}return m=e[s.pattern].tiles,n.delegateYield(r(m,v,p),"t0",15);case 15:n.next=19;break;case 17:return n.next=19,{tile:s,x:v,y:p};case 19:n.next=8;break;case 21:n.next=26;break;case 23:n.prev=23,n.t1=n.catch(6),f.e(n.t1);case 26:return n.prev=26,f.f(),n.finish(26);case 29:n.next=3;break;case 31:n.next=36;break;case 33:n.prev=33,n.t2=n.catch(1),u.e(n.t2);case 36:return n.prev=36,u.f(),n.finish(36);case 39:case"end":return n.stop()}}),n,null,[[1,33,36,39],[6,23,26,29]])},n=i.a.mark(r),o.delegateYield(r(t,0,0),"t0",3);case 3:case"end":return o.stop()}}),kt)}function _t(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Lt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ct=function(){function t(e,n){f()(this,t),this.sprites=e,this.size=n}return h()(t,[{key:"print",value:function(t,e,n,r){var i=this;M()(t).forEach((function(t,o){i.sprites.draw(t,e,n+o*i.size,r)}))}}]),t}();function zt(){return ht("".concat("super-mario/public/","img/font.png")).then((function(t){var e,n=new gt(t),r=t.width,i=_t(M()(" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~").entries());try{for(i.s();!(e=i.n()).done;){var o=a()(e.value,2),u=o[0],c=o[1],s=8*u%r,f=8*Math.floor(8*u/r);n.define(c,s,f,8,8)}}catch(t){i.e(t)}finally{i.f()}return new Ct(n,8)}))}function Nt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var Gt=function(t){d()(n,t);var e=Nt(n);function n(){var t;return f()(this,n),(t=e.call(this)).dir=0,t.acceleration=400,t.deceleration=300,t.dragFactor=2e-4,t.distance=0,t.heading=1,t}return h()(n,[{key:"update",value:function(t,e){var n=e.deltaTime,r=Math.abs(t.vel.x);if(0!==this.dir)t.vel.x+=this.acceleration*n*this.dir,this.heading=this.dir;else if(0!==t.vel.x){var i=Math.min(r,this.deceleration*n);t.vel.x+=t.vel.x>0?-i:i}else this.distance=0;var o=this.dragFactor*t.vel.x*r;t.vel.x-=o,this.distance+=r*n}}]),n}(D);function Bt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var Ft=function(t){d()(n,t);var e=Bt(n);function n(){var t;return f()(this,n),(t=e.call(this)).ready=0,t.duration=.3,t.engageTime=0,t.requestTime=0,t.gracePeriod=.1,t.speedBoost=.3,t.velocity=200,t.downblow=0,t.upblow=0,t}return h()(n,[{key:"start",value:function(){this.requestTime=this.gracePeriod}},{key:"cancel",value:function(){this.engageTime=0,this.requestTime=0}},{key:"obstruct",value:function(t,e){e===_.BOTTOM?this.ready=1:e===_.TOP&&this.cancel()}},{key:"update",value:function(t,e,n){var r=e.deltaTime;this.requestTime>0&&(this.ready>0&&(t.sounds.add("jump"),this.engageTime=this.duration,this.requestTime=0),this.requestTime-=r),this.engageTime>0&&(t.vel.y=-(this.velocity+Math.abs(t.vel.x)*this.speedBoost),this.engageTime-=r),this.ready--}},{key:"falling",get:function(){return this.ready<0}}]),n}(D);function Ut(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var Vt=function(t){d()(n,t);var e=Ut(n);function n(){return f()(this,n),e.apply(this,arguments)}return h()(n,[{key:"update",value:function(t,e,n){var r=e.deltaTime;t.pos.x+=t.vel.x*r,n.tileCollider.checkX(t,e,n),t.pos.y+=t.vel.y*r,n.tileCollider.checkY(t,e,n),t.vel.y+=n.gravity*r}}]),n}(D);function qt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var $t=function(t){d()(n,t);var e=qt(n);function n(){var t;return f()(this,n),(t=e.call(this)).obstructs=!0,t}return h()(n,[{key:"obstruct",value:function(t,e,n){this.obstructs&&(e===_.BOTTOM?(t.bounds.bottom=n.y1,t.vel.y=0):e===_.TOP?(t.bounds.top=n.y2,t.vel.y=0):e===_.LEFT?(t.bounds.left=n.x2,t.vel.x=0):e===_.RIGHT&&(t.bounds.right=n.x1,t.vel.x=0))}}]),n}(D);function Yt(t,e){var n,r=(n=e,function(t){return fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){return n.decodeAudioData(t)}))});return yt("".concat("super-mario/public/","sounds/").concat(t,".json")).then((function(t){var e=new I,n=t.fx;return Promise.all(Object.keys(n).map((function(t){return r("".concat("super-mario/public/"+n[t].url)).then((function(t){}))}))).then((function(){return e}))}))}function Kt(t){return Promise.all([bt("mario"),Yt("mario",t)]).then((function(t){var e=a()(t,2);return function(t,e){var n=t.animations.get("run");function r(t){this.traits.get(Gt).dragFactor=t?2e-4:.001}function i(t){this.traits.get(Ft).downblow=t?1:0}function o(t){this.traits.get(Ft).upblow=t?1:0}function a(e){var r;t.draw((r=this).traits.get(Ft).falling?r.traits.get(Ft).downblow>0?"downblow":r.traits.get(Ft).upblow>0?"upblow":"jump":r.traits.get(Gt).distance>0?r.vel.x>0&&r.traits.get(Gt).dir<0||r.vel.x<0&&r.traits.get(Gt).dir>0?"break":n(r.traits.get(Gt).distance):"idle",e,0,0,this.traits.get(Gt).heading<0)}return function(){var t=new L;return t.audio=e,t.size.set(22,47),t.addTrait(new Vt),t.addTrait(new $t),t.addTrait(new Gt),t.addTrait(new Ft),t.addTrait(new z),t.addTrait(new G),t.traits.get(z).removeAfter=0,t.turbo=r,t.downblow=i,t.upblow=o,t.draw=a,t.turbo(!1),t.downblow(!1),t.upblow(!1),t}}(e[0],e[1])}))}function Ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var Xt=function(t){d()(n,t);var e=Ht(n);function n(){var t;return f()(this,n),(t=e.call(this)).enabled=!0,t.speed=-30,t}return h()(n,[{key:"obstruct",value:function(t,e){e!==_.LEFT&&e!==_.RIGHT||(this.speed=-this.speed)}},{key:"update",value:function(t){this.enabled&&(t.vel.x=this.speed)}}]),n}(D);function Wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var Jt=function(t){d()(n,t);var e=Wt(n);function n(){return f()(this,n),e.apply(this,arguments)}return h()(n,[{key:"collides",value:function(t,e){t.traits.get(z).dead||e.traits.has(G)&&(e.vel.y>t.vel.y?(t.traits.get(z).kill(),t.traits.get(Xt).speed=0):e.traits.get(z).kill())}}]),n}(D);function Qt(t){var e=t.animations.get("walk");function n(n){var r;t.draw((r=this).traits.get(z).dead?"flat":e(r.lifetime),n,0,0)}return function(){var t=new L;return t.size.set(16,16),t.addTrait(new Vt),t.addTrait(new $t),t.addTrait(new Xt),t.addTrait(new Jt),t.addTrait(new z),t.draw=n,t}}function Zt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var te=Symbol("walking"),ee=Symbol("hiding"),ne=Symbol("panic"),re=function(t){d()(n,t);var e=Zt(n);function n(){var t;return f()(this,n),(t=e.call(this)).hideTime=0,t.hideDuration=5,t.walkSpeed=null,t.panicSpeed=300,t.state=te,t}return h()(n,[{key:"collides",value:function(t,e){t.traits.get(z).dead||e.traits.has(G)&&(e.vel.y>t.vel.y?this.handleStomp(t,e):this.handleNudge(t,e))}},{key:"handleNudge",value:function(t,e){if(this.state===te)e.traits.get(z).kill();else if(this.state===ee)this.panic(t,e);else if(this.state===ne){var n=Math.sign(t.vel.x),r=Math.sign(t.pos.x-e.pos.x);0!==n&&n!==r&&e.traits.get(z).kill()}}},{key:"handleStomp",value:function(t,e){this.state===te?this.hide(t):this.state===ee?(t.traits.get(z).kill(),t.vel.set(100,-200),t.traits.get($t).obstructs=!1):this.state===ne&&this.hide(t)}},{key:"hide",value:function(t){t.vel.x=0,t.traits.get(Xt).enabled=!1,null===this.walkSpeed&&(this.walkSpeed=t.traits.get(Xt).speed),this.hideTime=0,this.state=ee}},{key:"unhide",value:function(t){t.traits.get(Xt).enabled=!0,t.traits.get(Xt).speed=this.walkSpeed,this.state=te}},{key:"panic",value:function(t,e){t.traits.get(Xt).enabled=!0,t.traits.get(Xt).speed=this.panicSpeed*Math.sign(e.vel.x),this.state=ne}},{key:"update",value:function(t,e){var n=e.deltaTime;this.state===ee&&(this.hideTime+=n,this.hideTime>this.hideDuration&&this.unhide(t))}}]),n}(D);function ie(t){var e=t.animations.get("walk"),n=t.animations.get("wake");function r(r){var i;t.draw((i=this).traits.get(re).state===ee?i.traits.get(re).hideTime>3?n(i.traits.get(re).hideTime):"hiding":i.traits.get(re).state===ne?"hiding":e(i.lifetime),r,0,0,this.vel.x<0)}return function(){var t=new L;return t.size.set(16,16),t.offset.y=8,t.addTrait(new Vt),t.addTrait(new $t),t.addTrait(new Xt),t.addTrait(new z),t.addTrait(new re),t.draw=r,t}}function oe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ae=function(t){d()(n,t);var e=oe(n);function n(){return f()(this,n),e.apply(this,arguments)}return h()(n,[{key:"update",value:function(t,e,n){var r=e.deltaTime;t.vel.y+=n.gravity*r}}]),n}(D);function ue(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ce=function(t){d()(n,t);var e=ue(n);function n(){return f()(this,n),e.call(this)}return h()(n,[{key:"update",value:function(t,e,n){var r=e.deltaTime;t.pos.x+=t.vel.x*r,t.pos.y+=t.vel.y*r}}]),n}(D);function se(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var fe=function(t){d()(n,t);var e=se(n);function n(){var t;return f()(this,n),(t=e.call(this)).gravity=new ae,t}return h()(n,[{key:"collides",value:function(t,e){t.traits.get(z).dead||(console.log("Collision in Bullet",e.vel.y),e.traits.has(G)&&(e.vel.y>t.vel.y?(t.traits.get(z).kill(),t.vel.set(100,-200)):e.traits.get(z).kill()))}},{key:"update",value:function(t,e,n){t.traits.get(z).dead&&this.gravity.update(t,e,n)}}]),n}(D);function le(t){function e(e){t.draw("bullet",e,0,0,this.vel.x<0)}return function(){var t=new L;return t.size.set(16,14),t.addTrait(new ce),t.addTrait(new fe),t.addTrait(new z),t.draw=e,t}}function he(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ye(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ye(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function ye(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function de(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ve=function(t){d()(n,t);var e=de(n);function n(){var t;return f()(this,n),(t=e.call(this)).interval=2,t.coolDown=t.interval,t.emitters=[],t}return h()(n,[{key:"emit",value:function(t,e,n){var r,i=he(this.emitters);try{for(i.s();!(r=i.n()).done;){(0,r.value)(t,e,n)}}catch(t){i.e(t)}finally{i.f()}}},{key:"update",value:function(t,e,n){var r=e.deltaTime;this.coolDown-=r,this.coolDown<=0&&(this.emit(t,e,n),this.coolDown=this.interval)}}]),n}(D);function pe(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return me(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return me(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ge(t){return Yt("cannon",t).then((function(t){return function(t){function e(t,e,n){var r,i=1,o=pe(tt(n.entities));try{for(o.s();!(r=o.n()).done;){var a=r.value;if(a.pos.x>t.pos.x-30&&a.pos.x<t.pos.x+30)return;a.pos.x<t.pos.x&&(i=-1)}}catch(t){o.e(t)}finally{o.f()}var u=e.entityFactory.bullet();u.pos.copy(t.pos),u.vel.set(80*i,0),t.sounds.add("shoot"),n.entities.add(u)}return function(){var n=new L;n.audio=t;var r=new ve;return r.interval=4,r.emitters.push(e),n.addTrait(r),n}}(t)}))}function be(t){var e={};function n(t){return function(n){return e[t]=n}}return Promise.all([Kt(t).then(n("mario")),bt("goomba").then(Qt).then(n("goomba")),bt("koopa").then(ie).then(n("koopa")),bt("bullet").then(le).then(n("bullet")),ge(t).then(n("cannon"))]).then((function(){return e}))}var we=function(){function t(){f()(this,t),this.keyStates=new Map,this.keyMap=new Map}return h()(t,[{key:"addMapping",value:function(t,e){this.keyMap.set(t,e)}},{key:"handleEvent",value:function(t){var e=t.code;if(this.keyMap.has(e)){t.preventDefault();var n="keydown"===t.type?1:0;this.keyStates.get(e)!==n&&(this.keyStates.set(e,n),this.keyMap.get(e)(n))}}},{key:"listenTo",value:function(t){var e=this;["keydown","keyup"].forEach((function(n){t.addEventListener(n,(function(t){e.handleEvent(t)}))}))}}]),t}();function xe(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ke(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ke(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function ke(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Se=function(){function t(){f()(this,t),this.receivers=new Set}return h()(t,[{key:"addReceiver",value:function(t){this.receivers.add(t)}},{key:"dropReceiver",value:function(t){this.receivers.delete(t)}},{key:"route",value:function(t){var e,n=xe(this.receivers);try{for(n.s();!(e=n.n()).done;){t(e.value)}}catch(t){n.e(t)}finally{n.f()}}}]),t}();function Te(t){var e=new we,n=new Se;return e.listenTo(t),e.addMapping("KeyP",(function(t){t?n.route((function(t){return t.traits.get(Ft).start()})):n.route((function(t){return t.traits.get(Ft).cancel()}))})),e.addMapping("KeyO",(function(t){n.route((function(e){return e.turbo(t)}))})),e.addMapping("KeyD",(function(t){n.route((function(e){return e.traits.get(Gt).dir+=t?1:-1}))})),e.addMapping("KeyA",(function(t){n.route((function(e){return e.traits.get(Gt).dir+=t?-1:1}))})),e.addMapping("KeyS",(function(t){n.route((function(e){return e.downblow(t)}))})),e.addMapping("KeyW",(function(t){n.route((function(e){return e.upblow(t)}))})),n}function Ee(t){return function(e){e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)}}function Re(t,e){var n=t.size;return function(r){var i=e.length,o=Math.floor(r.canvas.width/n)/2-i/2,a=Math.floor(r.canvas.height/n)/2;t.print(e,r,o*n,a*n)}}function Ae(t){var e=[],n=t.tileSize,r=t.getByIndex;return t.getByIndex=function(n,i){return e.push({x:n,y:i}),r.call(t,n,i)},function(t,r){t.strokeStyle="blue",e.forEach((function(e){var i=e.x,o=e.y;t.beginPath(),t.rect(i*n-r.pos.x,o*n-r.pos.y,n,n),t.stroke()})),e.length=0}}function Ie(t){var e,n=t.tileCollider.resolvers.map(Ae),r=(e=t.entities,function(t,n){t.strokeStyle="red",e.forEach((function(e){t.beginPath(),t.rect(e.bounds.left-n.pos.x,e.bounds.top-n.pos.y,e.size.x,e.size.y),t.stroke()}))});return function(t,e){n.forEach((function(n){return n(t,e)})),r(t,e)}}function Oe(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return je(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return je(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function je(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Me(t,e){var n=t.size,r=2*t.size,i=function(t){var e,n=Oe(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.traits.has(ut))return r.traits.get(ut)}}catch(t){n.e(t)}finally{n.f()}}(e.entities);return function(o){var a=function(t){var e,n=Oe(tt(t));try{for(n.s();!(e=n.n()).done;){return e.value.traits.get(F)}}catch(t){n.e(t)}finally{n.f()}}(e.entities);t.print(a.name,o,16,n),t.print(a.score.toString().padStart(6,"0"),o,16,r),t.print("@x"+a.coins.toString().padStart(2,"0"),o,96,r),t.print("WORLD",o,152,n),t.print(e.name,o,160,r),t.print("TIME",o,208,n),t.print(i.currentTime.toFixed().toString().padStart(3,"0"),o,216,r)}}function Pe(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return De(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return De(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function De(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _e(t,e){var n=t.size,r=document.createElement("canvas");r.width=32,r.height=32;var i=r.getContext("2d");return function(o){var a=function(t){var e,n=Pe(tt(t));try{for(n.s();!(e=n.n()).done;){return e.value}}catch(t){n.e(t)}finally{n.f()}}(e.entities),u=a.traits.get(F);t.print("WORLD "+e.name,o,12*n,12*n),t.print("x "+u.lives.toString().padStart(3," "),o,16*n,16*n),i.clearRect(0,0,r.width,r.height),a.draw(i),o.drawImage(r,12*n,15*n)}}var Le=function(){function t(){f()(this,t),this.sceneIndex=-1,this.scenes=[]}return h()(t,[{key:"addScene",value:function(t){var e=this;t.events.listen(R.EVENT_COMPLETE,(function(){e.runNext()})),this.scenes.push(t)}},{key:"runNext",value:function(){var t=this.scenes[this.sceneIndex];t&&t.pause(),this.sceneIndex++}},{key:"update",value:function(t){var e=this.scenes[this.sceneIndex];e&&(e.update(t),e.draw(t))}}]),t}();function Ce(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}var ze=function(t){d()(n,t);var e=Ce(n);function n(){var t;return f()(this,n),(t=e.call(this)).countDown=2,t}return h()(n,[{key:"update",value:function(t){this.countDown-=t.deltaTime,this.countDown<=0&&this.events.emit(R.EVENT_COMPLETE)}}]),n}(R);function Ne(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Ge(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ge(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}function Ge(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Be(){return(Be=c()(i.a.mark((function t(e){var n,r,o,u,s,f,l,h,y,d,v,p,m;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return v=function(){return(v=c()(i.a.mark((function t(e){var n,r,o,a,u,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new R).comp.layers.push(Ee("#000")),n.comp.layers.push(Re(f,"Loading ".concat(e,"..."))),h.addScene(n),h.runNext(),t.next=7,l(e);case 7:(r=t.sent).events.listen(it.EVENT_TRIGGER,(function(t,e,n){if("goto"===t.type){var r,i=Ne(tt(n));try{for(i.s();!(r=i.n()).done;){r.value;return void d(t.name)}}catch(t){i.e(t)}finally{i.f()}}})),o=_e(f,r),a=Me(f,r),y.pos.set(0,0),r.entities.add(y),u=Q(y),r.entities.add(u),(c=new ze).countDown=2,c.comp.layers.push(Ee("#000")),c.comp.layers.push(a),c.comp.layers.push(o),h.addScene(c),r.comp.layers.push(Ie(r)),r.comp.layers.push(a),h.addScene(r),h.runNext();case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)},d=function(t){return v.apply(this,arguments)},n=e.getContext("2d"),r=new AudioContext,t.next=6,Promise.all([be(r),zt()]);case 6:return o=t.sent,u=a()(o,2),s=u[0],f=u[1],t.next=12,Ot(s);case 12:l=t.sent,h=new Le,Z(y=s.mario()),window.mario=y,Te(window).addReceiver(y),p={audioContext:r,videoContext:n,entityFactory:s,deltaTime:null},(m=new ot(1/60)).update=function(t){p.deltaTime=t,h.update(p)},m.start(),d("1-1");case 24:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Fe=document.getElementById("screen");window.addEventListener("load",(function(){!function(t){Be.apply(this,arguments)}(Fe)}))}]);